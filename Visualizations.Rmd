---
title: "powersim_vis"
author: "Belgin Unal"
date: "2023-01-10"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

options(dplyr.summarise.inform = FALSE)
```

Loading the required packages
```{r}
library(lme4)
library(tidyverse)
library(EstimationTools)
library(ggsci)
library(ggh4x)
library(gtable)
library(grid)
library(jcolors)
```


```{r}
setwd("C:/Users/Belgin/Desktop/Sensitivity Analysis")
```


Read the csv file that contains simulations
```{r}
iter_df <- read.csv(file = "Sim_Result.csv")
iter_df$X <- NULL
```

Hits (the cases where the effect was successfully detected)
```{r}
iter_df$as_sig <- ifelse(iter_df$as_p_value<=.05,1,0)
iter_df$ai_sig <- ifelse(iter_df$ai_p_value<=.05,1,0)
iter_df$ci_sig <- ifelse(iter_df$ci_p_value<=.05,1,0)
iter_df$cs_sig <- ifelse(iter_df$cs_p_value<=.05,1,0)
```


```{r}
# proportion of p values that are under .05 threshold
sig_results <- iter_df %>% group_by(Case, ai_slope, as_slope, ci_slope, cs_slope) %>%
  summarise(ai_prop = mean(ai_sig),
            as_prop = mean(as_sig),
            ci_prop = mean(ci_sig),
            cs_prop = mean(cs_sig))
```


```{r}
scaleFUN <- function(x) sprintf("%.2f", x)

param_labels <- c(expression(italic(a)[item]),
                  expression(italic(a)[context]),
                  expression(italic(c)[item]),
                  expression(italic(c)[context]))
```


```{r}
for (i in 1:22){
  assign(paste0("iter_df_case",i), iter_df %>% subset(Case==i) %>%
           select(ai_p_value,ci_p_value, as_p_value, cs_p_value) %>%
           pivot_longer(everything(), names_to = "parameter", values_to = "p_value"))
}

iter_df_case_list <- list(iter_df_case1, iter_df_case2, iter_df_case3,
                          iter_df_case4, iter_df_case5, iter_df_case6, 
                          iter_df_case7, iter_df_case8, iter_df_case9,
                          iter_df_case10, iter_df_case11, iter_df_case12, 
                          iter_df_case13, iter_df_case14, iter_df_case15, 
                          iter_df_case16, iter_df_case17, iter_df_case18,
                          iter_df_case19, iter_df_case20, iter_df_case21,
                          iter_df_case22)
```

```{r}
for (i in 1:22){
  assign(paste0("prop_df",i), iter_df_case_list[i] %>% group_by(parameter) %>%
           summarise(prop = sum(p_value <= .05)/n(),
                     ypos = 1.05))
         
}
```

DOT PLOTS

```{r}
ggplot(iter_df_case1, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df1, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())
```


```{r}
ggplot(iter_df_case2, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df2, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())
```


```{r}
ggplot(iter_df_case3, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df3, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())
```


```{r}
ggplot(iter_df_case4, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df4, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

```{r}
ggplot(iter_df_case5, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df5, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

```{r}
ggplot(iter_df_case6, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df6, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```


```{r}
ggplot(iter_df_case7, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df7, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

```{r}
ggplot(iter_df_case8, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df8, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

```{r}
ggplot(iter_df_case9, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df9, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```


```{r}
ggplot(iter_df_case10, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df10, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```


```{r}
ggplot(iter_df_case11, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df11, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```


```{r}
ggplot(iter_df_case12, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df12, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

```{r}
ggplot(iter_df_case13, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df13, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

```{r}
ggplot(iter_df_case14, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df14, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```


```{r}
ggplot(iter_df_case15, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df15, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

```{r}
ggplot(iter_df_case16, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df16, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

```{r}
ggplot(iter_df_case17, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df17, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

```{r}
ggplot(iter_df_case18, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df18, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```


```{r}
ggplot(iter_df_case19, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df19, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```

```{r}
ggplot(iter_df_case20, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df20, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```


```{r}
ggplot(iter_df_case21, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df21, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```


```{r}
ggplot(iter_df_case22, aes(x = parameter, y = p_value)) +
  labs(y = expression(paste(italic(p), " value"))) +
  geom_hline(aes(yintercept = .05), linetype = 'dashed', size = 2, colour = "red") +
  geom_jitter(width = 0.3) +
  scale_x_discrete(labels = param_labels)+
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  geom_text(data = prop_df22, aes(x=parameter, y=ypos,label = paste0(prop*100, "%")),
            size=10, colour = "red")+
  theme_light()+
  theme(axis.title.x=element_blank(),
        text = element_text(size=30),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

```


ROC PLOTS

```{r}
all_steps_r = seq(0, 1, 0.001)  #criterion values

roc_df_case1 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case1)){
    
    iter_df_case1$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case1$far[j] = as.numeric(iter_df_case1$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case1 <- rbind(roc_df_case1,iter_df_case1)
}

# write.csv(roc_df_case1, "roc_df_case1.csv")
```


```{r}
roc_far <- roc_df_case1 %>% group_by(parameter, step_p_value) %>%
  summarise(fa_rate = mean(far))

# write.csv(roc_far, "roc_far.csv")
```



```{r}
roc_df_case2 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case2)){
    
    iter_df_case2$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case2$hit[j] = as.numeric(iter_df_case2$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case2 <- rbind(roc_df_case2,iter_df_case2)
}

# write.csv(roc_df_case2, "roc_df_case2.csv")

roc_hr_sim2 <- roc_df_case2 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim2 = mean(hit))

# write.csv(roc_hr_sim2, "roc_hr_sim2.csv")
```

Combine the data frames
```{r}
case2 <- merge(roc_far, roc_hr_sim2, by = c("parameter", "step_p_value"))

case2_ai <- case2[case2$parameter == "ai_p_value",]

for (i in 1 : nrow(case2_ai)-1){
  case2_ai$auc[i] = (case2_ai$fa_rate[i+1] - case2_ai$fa_rate[i]) * case2_ai$hr_sim2[i+1]
}
```

Power Value
```{r}
case2_ai$hr_sim2[case2_ai$step_p_value==.05]
```

```{r}
case2_ai %>%
  ggplot(aes(x = fa_rate, y = hr_sim2)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case2_ai$auc),3))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


```{r}
roc_df_case3 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case3)){
    
    iter_df_case3$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case3$hit[j] = as.numeric(iter_df_case3$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case3 <- rbind(roc_df_case3,iter_df_case3)
}

# write.csv(roc_df_case3, "roc_df_case3.csv")

roc_hr_sim3 <- roc_df_case3 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim3 = mean(hit))

# write.csv(roc_hr_sim3, "roc_hr_sim3.csv")
```

Combine the data frames
```{r}
case3 <- merge(roc_far, roc_hr_sim3, by = c("parameter", "step_p_value"))

case3_ai <- case3[case3$parameter == "ai_p_value",]

for (i in 1 : nrow(case3_ai)-1){
  case3_ai$auc[i] = (case3_ai$fa_rate[i+1] - case3_ai$fa_rate[i]) * case3_ai$hr_sim3[i+1]
}
```

```{r}
case3_ai$hr_sim3[case3_ai$step_p_value==.05]
```

```{r}
case3_ai %>%
  ggplot(aes(x = fa_rate, y = hr_sim3)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case3_ai$auc),3))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```



```{r}
roc_df_case4 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case4)){
    
    iter_df_case4$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case4$hit[j] = as.numeric(iter_df_case4$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case4 <- rbind(roc_df_case4,iter_df_case4)
}

# write.csv(roc_df_case4, "roc_df_case4.csv")

roc_hr_sim4 <- roc_df_case4 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim4 = mean(hit))

# write.csv(roc_hr_sim4, "roc_hr_sim4.csv")
```


Combine the data frames
```{r}
case4 <- merge(roc_far, roc_hr_sim4, by = c("parameter", "step_p_value"))

case4_ai <- case4[case4$parameter == "ai_p_value",]

for (i in 1 : nrow(case4_ai)-1){
  case4_ai$auc[i] = (case4_ai$fa_rate[i+1] - case4_ai$fa_rate[i]) * case4_ai$hr_sim4[i+1]
}
```

```{r}
case4_ai$hr_sim4[case4_ai$step_p_value==.05]
```

```{r}
case4_ai %>%
  ggplot(aes(x = fa_rate, y = hr_sim4)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case4_ai$auc),2))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


```{r}
roc_df_case5 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case5)){
    
    iter_df_case5$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case5$hit[j] = as.numeric(iter_df_case5$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case5 <- rbind(roc_df_case5,iter_df_case5)
}

# write.csv(roc_df_case5, "roc_df_case5.csv")

roc_hr_sim5 <- roc_df_case5 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim5 = mean(hit))

# write.csv(roc_hr_sim5, "roc_hr_sim5.csv")
```

Combine the data frames
```{r}
case5 <- merge(roc_far, roc_hr_sim5, by = c("parameter", "step_p_value"))

case5_as <- case5[case5$parameter == "as_p_value",]

for (i in 1 : nrow(case5_as)-1){
  case5_as$auc[i] = (case5_as$fa_rate[i+1] - case5_as$fa_rate[i]) * case5_as$hr_sim5[i+1]
}
```

```{r}
case5_as$hr_sim5[case5_as$step_p_value==.05]
```

```{r}
case5_as %>%
  ggplot(aes(x = fa_rate, y = hr_sim5)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case5_as$auc),3))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```

```{r}
roc_df_case6 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case6)){
    
    iter_df_case6$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case6$hit[j] = as.numeric(iter_df_case6$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case6 <- rbind(roc_df_case6,iter_df_case6)
}

# write.csv(roc_df_case6, "roc_df_case6.csv")

roc_hr_sim6 <- roc_df_case6 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim6 = mean(hit))

# write.csv(roc_hr_sim6, "roc_hr_sim6.csv")
```

Combine the data frames
```{r}
case6 <- merge(roc_far, roc_hr_sim6, by = c("parameter", "step_p_value"))

case6_as <- case6[case6$parameter == "as_p_value",]

for (i in 1 : nrow(case6_as)-1){
  case6_as$auc[i] = (case6_as$fa_rate[i+1] - case6_as$fa_rate[i]) * case6_as$hr_sim6[i+1]
}
```

```{r}
case6_as$hr_sim6[case6_as$step_p_value==.05]
```

```{r}
case6_as %>%
  ggplot(aes(x = fa_rate, y = hr_sim6)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case6_as$auc),3))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


```{r}
roc_df_case7 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case7)){
    
    iter_df_case7$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case7$hit[j] = as.numeric(iter_df_case7$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case7 <- rbind(roc_df_case7,iter_df_case7)
}

# write.csv(roc_df_case7, "roc_df_case7.csv")

roc_hr_sim7 <- roc_df_case7 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim7 = mean(hit))

# write.csv(roc_hr_sim7, "roc_hr_sim7.csv")
```


```{r}
case7 <- merge(roc_far, roc_hr_sim7, by = c("parameter", "step_p_value"))

case7_as <- case7[case7$parameter == "as_p_value",]

for (i in 1 : nrow(case7_as)-1){
  case7_as$auc[i] = (case7_as$fa_rate[i+1] - case7_as$fa_rate[i]) * case7_as$hr_sim7[i+1]
}
```

```{r}
case7_as$hr_sim7[case7_as$step_p_value==.05]
```

```{r}
case7_as %>%
  ggplot(aes(x = fa_rate, y = hr_sim7)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case7_as$auc),2))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```

```{r}
roc_df_case8 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case8)){
    
    iter_df_case8$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case8$hit[j] = as.numeric(iter_df_case8$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case8 <- rbind(roc_df_case8,iter_df_case8)
}

# write.csv(roc_df_case8, "roc_df_case8.csv")

roc_hr_sim8 <- roc_df_case8 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim8 = mean(hit))

# write.csv(roc_hr_sim8, "roc_hr_sim8.csv")
```

```{r}
case8 <- merge(roc_far, roc_hr_sim8, by = c("parameter", "step_p_value"))

case8_cs <- case8[case8$parameter == "cs_p_value",]

for (i in 1 : nrow(case8_cs)-1){
  case8_cs$auc[i] = (case8_cs$fa_rate[i+1] - case8_cs$fa_rate[i]) * case8_cs$hr_sim8[i+1]
}
```


```{r}
case8_cs$hr_sim8[case8_cs$step_p_value==.05]
```

```{r}
case8_cs %>%
  ggplot(aes(x = fa_rate, y = hr_sim8)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case8_cs$auc),3))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```

```{r}
roc_df_case9 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case9)){
    
    iter_df_case9$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case9$hit[j] = as.numeric(iter_df_case9$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case9 <- rbind(roc_df_case9,iter_df_case9)
}

# write.csv(roc_df_case9, "roc_df_case9.csv")

roc_hr_sim9 <- roc_df_case9 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim9 = mean(hit))

# write.csv(roc_hr_sim9, "roc_hr_sim9.csv")
```

```{r}
case9 <- merge(roc_far, roc_hr_sim9, by = c("parameter", "step_p_value"))

case9_cs <- case9[case9$parameter == "cs_p_value",]

for (i in 1 : nrow(case9_cs)-1){
  case9_cs$auc[i] = (case9_cs$fa_rate[i+1] - case9_cs$fa_rate[i]) * case9_cs$hr_sim9[i+1]
}
```

```{r}
case9_cs$hr_sim9[case9_cs$step_p_value==.05]
```


```{r}
case9_cs %>%
  ggplot(aes(x = fa_rate, y = hr_sim9)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case9_cs$auc),3))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


```{r}
roc_df_case10 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case10)){
    
    iter_df_case10$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case10$hit[j] = as.numeric(iter_df_case10$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case10 <- rbind(roc_df_case10,iter_df_case10)
}

# write.csv(roc_df_case10, "roc_df_case10.csv")

roc_hr_sim10 <- roc_df_case10 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim10 = mean(hit))

# write.csv(roc_hr_sim10, "roc_hr_sim10.csv")
```


```{r}
case10 <- merge(roc_far, roc_hr_sim10, by = c("parameter", "step_p_value"))

case10_cs <- case10[case10$parameter == "cs_p_value",]

for (i in 1 : nrow(case10_cs)-1){
  case10_cs$auc[i] = (case10_cs$fa_rate[i+1] - case10_cs$fa_rate[i]) * case10_cs$hr_sim10[i+1]
}
```

```{r}
case10_cs$hr_sim10[case10_cs$step_p_value==.05]
```

```{r}
case10_cs %>%
  ggplot(aes(x = fa_rate, y = hr_sim10)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case10_cs$auc),3))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


```{r}
roc_df_case11 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case11)){
    
    iter_df_case11$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case11$hit[j] = as.numeric(iter_df_case11$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case11 <- rbind(roc_df_case11,iter_df_case11)
}

# write.csv(roc_df_case11, "roc_df_case11.csv")

roc_hr_sim11 <- roc_df_case11 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim11 = mean(hit))

# write.csv(roc_hr_sim11, "roc_hr_sim11.csv")
```


Try criterion on x axis and total error on the y axis
```{r}
error_df <- data.frame(matrix(nrow = 4004000))
error_df$matrix.nrow...4004000. <- NULL
error_df$parameter <- roc_df_case1$parameter
error_df$criterion <- roc_df_case1$step_p_value
error_df$far <- roc_df_case1$far
error_df$hit <- roc_df_case11$hit

error_df <- error_df %>% filter(parameter == "ci_p_value")


error_df <- error_df %>% group_by(criterion) %>%
  summarise_each(funs(sum(.==0))) %>%
  mutate(far = 1000-far)
colnames(error_df)[4] <- "miss"

#total error
error_df$total_error <- error_df$far + error_df$miss
error_df$far_per <- error_df$far/1000
error_df$miss_per <- error_df$miss/1000
error_df$total_per <- error_df$far_per + error_df$miss_per


```

```{r}
error_df$lab <- paste(error_df$criterion,error_df$total_per, sep=", ")

error_df %>% 
  ggplot(aes(x = criterion, y = total_per)) +
  geom_line(size = 1, colour = "gray9") +
  geom_point(data = error_df[which.min(error_df$total_per), ], color="blue", 
             size=3) +
  geom_text(data = error_df[which.min(error_df$total_per),], aes(criterion,total_per+.05, label=lab),
            color = "blue", size = 6) +
  theme_light()+
  labs(x = "Criterion", y = "Total Error") + 
  annotate(geom="text", x=0.75, y=0.55, 
           label=paste0("Type 1 = ",
           round(error_df[which.min(error_df$total_per), ]$far_per,3)),size = 6) + 
  annotate(geom="text", x=0.75, y=0.53, 
           label=paste0("Type 2 = ",
           round(error_df[which.min(error_df$total_per), ]$miss_per,3)),size = 6) +
  theme(text = element_text(size=25),
        plot.margin = unit(c(1,1,1,1), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


```{r}
case11 <- merge(roc_far, roc_hr_sim11, by = c("parameter", "step_p_value"))

case11_ci <- case11[case11$parameter == "ci_p_value",]

for (i in 1 : nrow(case11_ci)-1){
  case11_ci$auc[i] = (case11_ci$fa_rate[i+1] - case11_ci$fa_rate[i]) * case11_ci$hr_sim11[i+1]
}
```

```{r}
case11_ci$hr_sim11[case11_ci$step_p_value==.05]
```

```{r}
case11_ci %>%
  ggplot(aes(x = fa_rate, y = hr_sim11)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case11_ci$auc),3))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```

```{r}
roc_df_case12 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case12)){
    
    iter_df_case12$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case12$hit[j] = as.numeric(iter_df_case12$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case12 <- rbind(roc_df_case12,iter_df_case12)
}

# write.csv(roc_df_case12, "roc_df_case12.csv")

roc_hr_sim12 <- roc_df_case12 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim12 = mean(hit))

# write.csv(roc_hr_sim12, "roc_hr_sim12.csv")
```


```{r}
case12 <- merge(roc_far, roc_hr_sim12, by = c("parameter", "step_p_value"))

case12_ci <- case12[case12$parameter == "ci_p_value",]

for (i in 1 : nrow(case12_ci)-1){
  case12_ci$auc[i] = (case12_ci$fa_rate[i+1] - case12_ci$fa_rate[i]) * case12_ci$hr_sim12[i+1]
}
```

```{r}
case12_ci$hr_sim12[case12_ci$step_p_value==.05]
```

```{r}
case12_ci %>%
  ggplot(aes(x = fa_rate, y = hr_sim12)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case12_ci$auc),3))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


```{r}
roc_df_case13 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case13)){
    
    iter_df_case13$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case13$hit[j] = as.numeric(iter_df_case13$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case13 <- rbind(roc_df_case13,iter_df_case13)
}

# write.csv(roc_df_case13, "roc_df_case13.csv")

roc_hr_sim13 <- roc_df_case13 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim13 = mean(hit))

# write.csv(roc_hr_sim13, "roc_hr_sim13.csv")
```


```{r}
case13 <- merge(roc_far, roc_hr_sim13, by = c("parameter", "step_p_value"))

case13_ci <- case13[case13$parameter == "ci_p_value",]

for (i in 1 : nrow(case13_ci)-1){
  case13_ci$auc[i] = (case13_ci$fa_rate[i+1] - case13_ci$fa_rate[i]) * case13_ci$hr_sim13[i+1]
}
```

```{r}
case13_ci$hr_sim13[case13_ci$step_p_value==.05]
```

```{r}
case13_ci %>%
  ggplot(aes(x = fa_rate, y = hr_sim13)) + 
  geom_point(colour = "gray9") + 
  geom_line(size = 2, colour = "gray9") +
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC = ", toString(round(sum(case13_ci$auc),2))), 
           size = 8) + 
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


COMBINATIONS

Case 14
```{r}
roc_df_case14 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case14)){
    
    iter_df_case14$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case14$hit[j] = as.numeric(iter_df_case14$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case14 <- rbind(roc_df_case14,iter_df_case14)
}

# write.csv(roc_df_case14, "roc_df_case14.csv")

roc_hr_sim14 <- roc_df_case14 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim14 = mean(hit))

# write.csv(roc_hr_sim14, "roc_hr_sim14.csv")
```

```{r}
case14 <- merge(roc_far, roc_hr_sim14, by = c("parameter", "step_p_value"))

case14 <- case14[case14$parameter == "ai_p_value" | case14$parameter == "as_p_value" ,]

case14_ai <- case14[case14$parameter == "ai_p_value",]
case14_as <- case14[case14$parameter == "as_p_value",]

#auc for ai
for (i in 1 : nrow(case14_ai)-1){
  case14_ai$auc[i] = (case14_ai$fa_rate[i+1] - case14_ai$fa_rate[i]) * case14_ai$hr_sim14[i+1]
}

#auc for as
for (i in 1 : nrow(case14_as)-1){
  case14_as$auc[i] = (case14_as$fa_rate[i+1] - case14_as$fa_rate[i]) * case14_as$hr_sim14[i+1]
}
```


```{r}
case14_ai$hr_sim14[case14_ai$step_p_value==.05]
case14_as$hr_sim14[case14_as$step_p_value==.05]
```

```{r}
case14 %>%
  ggplot(aes(x = fa_rate, y = hr_sim14)) + 
  geom_point(size = 0.2, aes(colour = parameter)) + 
  geom_line(size = 1, aes(linetype = parameter, colour = parameter)) +
  scale_color_manual(values = c(ai_p_value = "darkblue", 
                                as_p_value = "sienna3"))+
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC[ai] == ", toString(round(sum(case14_ai$auc),3))), 
           size = 8, colour = "darkblue", parse = TRUE) + 
  annotate(geom="text", x=0.75, y=0.20, label=paste0("AUC[as] == ", toString(round(sum(case14_as$auc),3))), 
           size = 8, colour = "sienna3", parse = TRUE) +
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


Case 15
```{r}
roc_df_case15 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case15)){
    
    iter_df_case15$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case15$hit[j] = as.numeric(iter_df_case15$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case15 <- rbind(roc_df_case15,iter_df_case15)
}

# write.csv(roc_df_case15, "roc_df_case15.csv")

roc_hr_sim15 <- roc_df_case15 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim15 = mean(hit))

# write.csv(roc_hr_sim15, "roc_hr_sim15.csv")
```

```{r}
case15 <- merge(roc_far, roc_hr_sim15, by = c("parameter", "step_p_value"))

case15 <- case15[case15$parameter == "ai_p_value" | case15$parameter == "as_p_value" ,]

case15_ai <- case15[case15$parameter == "ai_p_value",]
case15_as <- case15[case15$parameter == "as_p_value",]

#auc for ai
for (i in 1 : nrow(case15_ai)-1){
  case15_ai$auc[i] = (case15_ai$fa_rate[i+1] - case15_ai$fa_rate[i]) * case15_ai$hr_sim15[i+1]
}

#auc for as
for (i in 1 : nrow(case15_as)-1){
  case15_as$auc[i] = (case15_as$fa_rate[i+1] - case15_as$fa_rate[i]) * case15_as$hr_sim15[i+1]
}

```

```{r}
case15_ai$hr_sim15[case15_ai$step_p_value==.05]
case15_as$hr_sim15[case15_as$step_p_value==.05]
```


```{r}
case15 %>%
  ggplot(aes(x = fa_rate, y = hr_sim15)) + 
  geom_point(size = 0.2, aes(colour = parameter)) + 
  geom_line(size = 2, aes(linetype = parameter, colour = parameter)) +
  scale_color_manual(values = c(ai_p_value = "darkblue", 
                                as_p_value = "sienna3"))+
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC[ai] == ", toString(round(sum(case15_ai$auc),3))), 
           size = 8, colour = "darkblue", parse = TRUE) + 
  annotate(geom="text", x=0.75, y=0.20, label=paste0("AUC[as] == ", toString(round(sum(case15_as$auc),3))), 
           size = 8, colour = "sienna3", parse = TRUE) +
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


Case 16
```{r}
roc_df_case16 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case16)){
    
    iter_df_case16$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case16$hit[j] = as.numeric(iter_df_case16$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case16 <- rbind(roc_df_case16,iter_df_case16)
}

# write.csv(roc_df_case16, "roc_df_case16.csv")

roc_hr_sim16 <- roc_df_case16 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim16 = mean(hit))

# write.csv(roc_hr_sim16, "roc_hr_sim16.csv")
```


```{r}
case16 <- merge(roc_far, roc_hr_sim16, by = c("parameter", "step_p_value"))

case16 <- case16[case16$parameter == "ai_p_value" | case16$parameter == "as_p_value" ,]

case16_ai <- case16[case16$parameter == "ai_p_value",]
case16_as <- case16[case16$parameter == "as_p_value",]

#auc for ai
for (i in 1 : nrow(case16_ai)-1){
  case16_ai$auc[i] = (case16_ai$fa_rate[i+1] - case16_ai$fa_rate[i]) * case16_ai$hr_sim16[i+1]
}

#auc for as
for (i in 1 : nrow(case16_as)-1){
  case16_as$auc[i] = (case16_as$fa_rate[i+1] - case16_as$fa_rate[i]) * case16_as$hr_sim16[i+1]
}

```


```{r}
case16_ai$hr_sim16[case16_ai$step_p_value==.05]
case16_as$hr_sim16[case16_as$step_p_value==.05]
```

```{r}
case16 %>%
  ggplot(aes(x = fa_rate, y = hr_sim16)) + 
  geom_point(size = 0.2, aes(colour = parameter)) + 
  geom_line(size = 2, aes(linetype = parameter, colour = parameter)) +
  scale_color_manual(values = c(ai_p_value = "darkblue", 
                                as_p_value = "sienna3"))+
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC[ai] == ", toString(round(sum(case16_ai$auc),2))), 
           size = 8, colour = "darkblue", parse = TRUE) + 
  annotate(geom="text", x=0.75, y=0.20, label=paste0("AUC[as] == ", toString(round(sum(case16_as$auc),2))), 
           size = 8, colour = "sienna3", parse = TRUE) +
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```

Case 17
```{r}
roc_df_case17 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case17)){
    
    iter_df_case17$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case17$hit[j] = as.numeric(iter_df_case17$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case17 <- rbind(roc_df_case17,iter_df_case17)
}

# write.csv(roc_df_case17, "roc_df_case17.csv")

roc_hr_sim17 <- roc_df_case17 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim17 = mean(hit))

# write.csv(roc_hr_sim17, "roc_hr_sim17.csv")
```

```{r}
case17 <- merge(roc_far, roc_hr_sim17, by = c("parameter", "step_p_value"))

case17 <- case17[case17$parameter == "ci_p_value" | case17$parameter == "cs_p_value" ,]

case17_ci <- case17[case17$parameter == "ci_p_value",]
case17_cs <- case17[case17$parameter == "cs_p_value",]

#auc for ci
for (i in 1 : nrow(case17_ci)-1){
  case17_ci$auc[i] = (case17_ci$fa_rate[i+1] - case17_ci$fa_rate[i]) * case17_ci$hr_sim17[i+1]
}

#auc for cs
for (i in 1 : nrow(case17_cs)-1){
  case17_cs$auc[i] = (case17_cs$fa_rate[i+1] - case17_cs$fa_rate[i]) * case17_cs$hr_sim17[i+1]
}

```


```{r}
case17_ci$hr_sim17[case17_ci$step_p_value==.05]
case17_cs$hr_sim17[case17_cs$step_p_value==.05]
```

```{r}
case17 %>%
  ggplot(aes(x = fa_rate, y = hr_sim17)) + 
  geom_point(size = 0.2, aes(colour = parameter)) + 
  geom_line(size = 1.5, aes(linetype = parameter, colour = parameter)) +
  scale_color_manual(values = c(ci_p_value = "darkblue", 
                                cs_p_value = "sienna3"))+
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC[ci] == ", toString(round(sum(case17_ci$auc),4))), 
           size = 8, colour = "darkblue", parse = TRUE) + 
  annotate(geom="text", x=0.75, y=0.20, label=paste0("AUC[cs] == ", toString(round(sum(case17_cs$auc),4))), 
           size = 8, colour = "sienna3", parse = TRUE) +
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```

Case 18
```{r}
roc_df_case18 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case18)){
    
    iter_df_case18$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case18$hit[j] = as.numeric(iter_df_case18$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case18 <- rbind(roc_df_case18,iter_df_case18)
}

# write.csv(roc_df_case18, "roc_df_case18.csv")

roc_hr_sim18 <- roc_df_case18 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim18 = mean(hit))

# write.csv(roc_hr_sim18, "roc_hr_sim18.csv")
```

```{r}
case18 <- merge(roc_far, roc_hr_sim18, by = c("parameter", "step_p_value"))

case18 <- case18[case18$parameter == "ci_p_value" | case18$parameter == "cs_p_value" ,]

case18_ci <- case18[case18$parameter == "ci_p_value",]
case18_cs <- case18[case18$parameter == "cs_p_value",]

#auc for ci
for (i in 1 : nrow(case18_ci)-1){
  case18_ci$auc[i] = (case18_ci$fa_rate[i+1] - case18_ci$fa_rate[i]) * case18_ci$hr_sim18[i+1]
}

#auc for cs
for (i in 1 : nrow(case18_cs)-1){
  case18_cs$auc[i] = (case18_cs$fa_rate[i+1] - case18_cs$fa_rate[i]) * case18_cs$hr_sim18[i+1]
}

```

```{r}
case18_ci$hr_sim18[case18_ci$step_p_value==.05]
case18_cs$hr_sim18[case18_cs$step_p_value==.05]
```

```{r}
case18 %>%
  ggplot(aes(x = fa_rate, y = hr_sim18)) + 
  geom_point(size = 0.2, aes(colour = parameter)) + 
  geom_line(size = 1.5, aes(linetype = parameter, colour = parameter)) +
  scale_color_manual(values = c(ci_p_value = "darkblue", 
                                cs_p_value = "sienna3"))+
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC[ci] == ", toString(round(sum(case18_ci$auc),3))), 
           size = 8, colour = "darkblue", parse = TRUE) + 
  annotate(geom="text", x=0.75, y=0.20, label=paste0("AUC[cs] == ", toString(round(sum(case18_cs$auc),3))), 
           size = 8, colour = "sienna3", parse = TRUE) +
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```

Case 19
```{r}
roc_df_case19 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case19)){
    
    iter_df_case19$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case19$hit[j] = as.numeric(iter_df_case19$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case19 <- rbind(roc_df_case19,iter_df_case19)
}

# write.csv(roc_df_case19, "roc_df_case19.csv")

roc_hr_sim19 <- roc_df_case19 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim19 = mean(hit))

# write.csv(roc_hr_sim19, "roc_hr_sim19.csv")
```

```{r}
case19 <- merge(roc_far, roc_hr_sim19, by = c("parameter", "step_p_value"))

case19 <- case19[case19$parameter == "ci_p_value" | case19$parameter == "cs_p_value" ,]

case19_ci <- case19[case19$parameter == "ci_p_value",]
case19_cs <- case19[case19$parameter == "cs_p_value",]

#auc for ci
for (i in 1 : nrow(case19_ci)-1){
  case19_ci$auc[i] = (case19_ci$fa_rate[i+1] - case19_ci$fa_rate[i]) * case19_ci$hr_sim19[i+1]
}

#auc for cs
for (i in 1 : nrow(case19_cs)-1){
  case19_cs$auc[i] = (case19_cs$fa_rate[i+1] - case19_cs$fa_rate[i]) * case19_cs$hr_sim19[i+1]
}

```

```{r}
case19_ci$hr_sim19[case19_ci$step_p_value==.05]
case19_cs$hr_sim19[case19_cs$step_p_value==.05]
```

```{r}
case19 %>%
  ggplot(aes(x = fa_rate, y = hr_sim19)) + 
  geom_point(size = 0.2, aes(colour = parameter)) + 
  geom_line(size = 1.5, aes(linetype = parameter, colour = parameter)) +
  scale_color_manual(values = c(ci_p_value = "darkblue", 
                                cs_p_value = "sienna3"))+
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC[ci] == ", toString(round(sum(case19_ci$auc),2))), 
           size = 8, colour = "darkblue", parse = TRUE) + 
  annotate(geom="text", x=0.75, y=0.20, label=paste0("AUC[cs] == ", toString(round(sum(case19_cs$auc),2))), 
           size = 8, colour = "sienna3", parse = TRUE) +
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


Case 20
```{r}
roc_df_case20 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case20)){
    
    iter_df_case20$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case20$hit[j] = as.numeric(iter_df_case20$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case20 <- rbind(roc_df_case20,iter_df_case20)
}

# write.csv(roc_df_case20, "roc_df_case20.csv")

roc_hr_sim20 <- roc_df_case20 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim20 = mean(hit))

# write.csv(roc_hr_sim20, "roc_hr_sim20.csv")
```



```{r}
case20 <- merge(roc_far, roc_hr_sim20, by = c("parameter", "step_p_value"))

case20_ai <- case20[case20$parameter == "ai_p_value",]
case20_as <- case20[case20$parameter == "as_p_value",]
case20_ci <- case20[case20$parameter == "ci_p_value",]
case20_cs <- case20[case20$parameter == "cs_p_value",]

#auc for ai
for (i in 1 : nrow(case20_ai)-1){
  case20_ai$auc[i] = (case20_ai$fa_rate[i+1] - case20_ai$fa_rate[i]) * case20_ai$hr_sim20[i+1]
}

#auc for as
for (i in 1 : nrow(case20_as)-1){
  case20_as$auc[i] = (case20_as$fa_rate[i+1] - case20_as$fa_rate[i]) * case20_as$hr_sim20[i+1]
}


#auc for ci
for (i in 1 : nrow(case20_ci)-1){
  case20_ci$auc[i] = (case20_ci$fa_rate[i+1] - case20_ci$fa_rate[i]) * case20_ci$hr_sim20[i+1]
}

#auc for cs
for (i in 1 : nrow(case20_cs)-1){
  case20_cs$auc[i] = (case20_cs$fa_rate[i+1] - case20_cs$fa_rate[i]) * case20_cs$hr_sim20[i+1]
}

```

```{r}
case20_ai$hr_sim20[case20_ai$step_p_value==.05]
case20_as$hr_sim20[case20_as$step_p_value==.05]
case20_ci$hr_sim20[case20_ci$step_p_value==.05]
case20_cs$hr_sim20[case20_cs$step_p_value==.05]
```

```{r}
case20 %>%
  ggplot(aes(x = fa_rate, y = hr_sim20)) + 
  geom_point(size = 0.2, aes(colour = parameter)) + 
  geom_line(size = 1.5, aes(linetype = parameter, colour = parameter)) +
  scale_color_manual(values = c(ci_p_value = "darkblue", 
                                cs_p_value = "sienna3",
                                ai_p_value = "springgreen4",
                                as_p_value = "violetred4"))+
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC[ai] == ", toString(round(sum(case20_ai$auc),3))), 
           size = 8, colour = "springgreen4", parse = TRUE) + 
  annotate(geom="text", x=0.75, y=0.20, label=paste0("AUC[as] == ", toString(round(sum(case20_as$auc),3))), 
           size = 8, colour = "violetred4", parse = TRUE) +
  annotate(geom="text", x=0.75, y=0.15, label=paste0("AUC[ci] == ", toString(round(sum(case20_ci$auc),3))), 
           size = 8, colour = "darkblue", parse = TRUE) +
  annotate(geom="text", x=0.75, y=0.10, label=paste0("AUC[cs] == ", toString(round(sum(case20_cs$auc),3))), 
           size = 8, colour = "sienna3", parse = TRUE) +
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```


Case 21
```{r}
roc_df_case21 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case21)){
    
    iter_df_case21$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case21$hit[j] = as.numeric(iter_df_case21$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case21 <- rbind(roc_df_case21,iter_df_case21)
}

# write.csv(roc_df_case21, "roc_df_case21.csv")

roc_hr_sim21 <- roc_df_case21 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim21 = mean(hit))

# write.csv(roc_hr_sim21, "roc_hr_sim21.csv")
```

```{r}
case21 <- merge(roc_far, roc_hr_sim21, by = c("parameter", "step_p_value"))

case21_ai <- case21[case21$parameter == "ai_p_value",]
case21_as <- case21[case21$parameter == "as_p_value",]
case21_ci <- case21[case21$parameter == "ci_p_value",]
case21_cs <- case21[case21$parameter == "cs_p_value",]

#auc for ai
for (i in 1 : nrow(case21_ai)-1){
  case21_ai$auc[i] = (case21_ai$fa_rate[i+1] - case21_ai$fa_rate[i]) * case21_ai$hr_sim21[i+1]
}

#auc for as
for (i in 1 : nrow(case21_as)-1){
  case21_as$auc[i] = (case21_as$fa_rate[i+1] - case21_as$fa_rate[i]) * case21_as$hr_sim21[i+1]
}


#auc for ci
for (i in 1 : nrow(case21_ci)-1){
  case21_ci$auc[i] = (case21_ci$fa_rate[i+1] - case21_ci$fa_rate[i]) * case21_ci$hr_sim21[i+1]
}

#auc for cs
for (i in 1 : nrow(case21_cs)-1){
  case21_cs$auc[i] = (case21_cs$fa_rate[i+1] - case21_cs$fa_rate[i]) * case21_cs$hr_sim21[i+1]
}

```

```{r}
case21_ai$hr_sim21[case21_ai$step_p_value==.05]
case21_as$hr_sim21[case21_as$step_p_value==.05]
case21_ci$hr_sim21[case21_ci$step_p_value==.05]
case21_cs$hr_sim21[case21_cs$step_p_value==.05]
```

```{r}
case21 %>%
  ggplot(aes(x = fa_rate, y = hr_sim21)) + 
  geom_point(size = 0.2, aes(colour = parameter)) + 
  geom_line(size = 1.5, aes(linetype = parameter, colour = parameter)) +
  scale_color_manual(values = c(ci_p_value = "darkblue", 
                                cs_p_value = "sienna3",
                                ai_p_value = "springgreen4",
                                as_p_value = "violetred4"))+
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC[ai] == ", toString(round(sum(case21_ai$auc),3))), 
           size = 8, colour = "springgreen4", parse = TRUE) + 
  annotate(geom="text", x=0.75, y=0.20, label=paste0("AUC[as] == ", toString(round(sum(case21_as$auc),3))), 
           size = 8, colour = "violetred4", parse = TRUE) +
  annotate(geom="text", x=0.75, y=0.15, label=paste0("AUC[ci] == ", toString(round(sum(case21_ci$auc),3))), 
           size = 8, colour = "darkblue", parse = TRUE) +
  annotate(geom="text", x=0.75, y=0.10, label=paste0("AUC[cs] == ", toString(round(sum(case21_cs$auc),3))), 
           size = 8, colour = "sienna3", parse = TRUE) +
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```

Case 22
```{r}
roc_df_case22 <- data.frame()

for (i in 1:length(all_steps_r)){
  
  for (j in 1:nrow(iter_df_case22)){
    
    iter_df_case22$step_p_value[j] <- all_steps_r[i]
    
    iter_df_case22$hit[j] = as.numeric(iter_df_case22$p_value[j]<=all_steps_r[i])
    
  }
  
  roc_df_case22 <- rbind(roc_df_case22,iter_df_case22)
}

# write.csv(roc_df_case22, "roc_df_case22.csv")

roc_hr_sim22 <- roc_df_case22 %>% group_by(parameter, step_p_value) %>%
  summarise(hr_sim22 = mean(hit))

# write.csv(roc_hr_sim22, "roc_hr_sim22.csv")
```

```{r}
case22 <- merge(roc_far, roc_hr_sim22, by = c("parameter", "step_p_value"))

case22_ai <- case22[case22$parameter == "ai_p_value",]
case22_as <- case22[case22$parameter == "as_p_value",]
case22_ci <- case22[case22$parameter == "ci_p_value",]
case22_cs <- case22[case22$parameter == "cs_p_value",]

#auc for ai
for (i in 1 : nrow(case22_ai)-1){
  case22_ai$auc[i] = (case22_ai$fa_rate[i+1] - case22_ai$fa_rate[i]) * case22_ai$hr_sim22[i+1]
}

#auc for as
for (i in 1 : nrow(case22_as)-1){
  case22_as$auc[i] = (case22_as$fa_rate[i+1] - case22_as$fa_rate[i]) * case22_as$hr_sim22[i+1]
}


#auc for ci
for (i in 1 : nrow(case22_ci)-1){
  case22_ci$auc[i] = (case22_ci$fa_rate[i+1] - case22_ci$fa_rate[i]) * case22_ci$hr_sim22[i+1]
}

#auc for cs
for (i in 1 : nrow(case22_cs)-1){
  case22_cs$auc[i] = (case22_cs$fa_rate[i+1] - case22_cs$fa_rate[i]) * case22_cs$hr_sim22[i+1]
}

```

```{r}
case22_ai$hr_sim22[case22_ai$step_p_value==.05]
case22_as$hr_sim22[case22_as$step_p_value==.05]
case22_ci$hr_sim22[case22_ci$step_p_value==.05]
case22_cs$hr_sim22[case22_cs$step_p_value==.05]
```

```{r}
case22 %>%
  ggplot(aes(x = fa_rate, y = hr_sim22)) + 
  geom_point(size = 0.2, aes(colour = parameter)) + 
  geom_line(size = 1.5, aes(linetype = parameter, colour = parameter)) +
  scale_color_manual(values = c(ci_p_value = "darkblue", 
                                cs_p_value = "sienna3",
                                ai_p_value = "springgreen4",
                                as_p_value = "violetred4"))+
  geom_abline(intercept = 0, slope = 1, size = 1.3, linetype = "dashed", colour = "darkred") + 
  scale_x_continuous(limits=c(0,1), expand = c(0,0)) +
  scale_y_continuous(limits=c(0,1), expand = c(0,0)) + 
  labs(x = "FAR", y = "HR") + 
  annotate(geom="text", x=0.75, y=0.25, label=paste0("AUC[ai] == ", toString(round(sum(case22_ai$auc),2))), 
           size = 8, colour = "springgreen4", parse = TRUE) +
  annotate(geom="text", x=0.75, y=0.20, label=paste0("AUC[as] == ", toString(round(sum(case22_as$auc),2))), 
           size = 8, colour = "violetred4", parse = TRUE) +
  annotate(geom="text", x=0.75, y=0.15, label=paste0("AUC[ci] == ", toString(round(sum(case22_ci$auc),2))), 
           size = 8, colour = "darkblue", parse = TRUE) +
  annotate(geom="text", x=0.75, y=0.10, label=paste0("AUC[cs] == ", toString(round(sum(case22_cs$auc),2))), 
           size = 8, colour = "sienna3", parse = TRUE) +
  theme_light()+
  theme(text = element_text(size=25),
        aspect.ratio=1,
        plot.margin = unit(c(1,1,1,0), "cm"),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none")
```